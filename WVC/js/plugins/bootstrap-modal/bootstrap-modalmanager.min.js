!function(d){function f(a){return function(b){if(this===b.target)return a.apply(this,arguments)}}var h=function(a,b){this.init(a,b)};h.prototype={constructor:h,init:function(a,b){this.$element=d(a);this.options=d.extend({},d.fn.modalmanager.defaults,this.$element.data(),"object"==typeof b&&b);this.stack=[];this.backdropCount=0;if(this.options.resize){var c,e=this;d(window).on("resize.modal",function(){c&&clearTimeout(c);c=setTimeout(function(){for(var a=0;a<e.stack.length;a++)e.stack[a].isShown&&
e.stack[a].layout()},10)})}},createModal:function(a,b){d(a).modal(d.extend({manager:this},b))},appendModal:function(a){this.stack.push(a);var b=this;a.$element.on("show.modalmanager",f(function(c){c=function(){a.isShown=!0;var c=d.support.transition&&a.$element.hasClass("fade");b.$element.toggleClass("modal-open",b.hasOpenModal()).toggleClass("page-overflow",d(window).height()<b.$element.height());a.$parent=a.$element.parent();a.$container=b.createContainer(a);a.$element.appendTo(a.$container);b.backdrop(a,
function(){a.$element.show();c&&a.$element[0].offsetWidth;a.layout();a.$element.addClass("in").attr("aria-hidden",!1);var g=function(){b.setFocus();a.$element.trigger("shown")};c?a.$element.one(d.support.transition.end,g):g()})};a.options.replace?b.replace(c):c()}));a.$element.on("hidden.modalmanager",f(function(c){b.backdrop(a);a.$backdrop?(d.support.transition&&a.$element.hasClass("fade")&&a.$element[0].offsetWidth,d.support.transition&&a.$element.hasClass("fade")?a.$backdrop.one(d.support.transition.end,
function(){b.destroyModal(a)}):b.destroyModal(a)):b.destroyModal(a)}));a.$element.on("destroy.modalmanager",f(function(c){b.removeModal(a)}))},destroyModal:function(a){a.destroy();var b=this.hasOpenModal();this.$element.toggleClass("modal-open",b);b||this.$element.removeClass("page-overflow");this.removeContainer(a);this.setFocus()},getOpenModals:function(){for(var a=[],b=0;b<this.stack.length;b++)this.stack[b].isShown&&a.push(this.stack[b]);return a},hasOpenModal:function(){return 0<this.getOpenModals().length},
setFocus:function(){for(var a,b=0;b<this.stack.length;b++)this.stack[b].isShown&&(a=this.stack[b]);a&&a.focus()},removeModal:function(a){a.$element.off(".modalmanager");a.$backdrop&&this.removeBackdrop(a);this.stack.splice(this.getIndexOfModal(a),1)},getModalAt:function(a){return this.stack[a]},getIndexOfModal:function(a){for(var b=0;b<this.stack.length;b++)if(a===this.stack[b])return b},replace:function(a){for(var b,c=0;c<this.stack.length;c++)this.stack[c].isShown&&(b=this.stack[c]);b?(this.$backdropHandle=
b.$backdrop,b.$backdrop=null,a&&b.$element.one("hidden",f(d.proxy(a,this))),b.hide()):a&&a()},removeBackdrop:function(a){a.$backdrop.remove();a.$backdrop=null},createBackdrop:function(a,b){var c;this.$backdropHandle?(c=this.$backdropHandle,c.off(".modalmanager"),this.$backdropHandle=null,this.isLoading&&this.removeSpinner()):c=d(b).addClass(a).appendTo(this.$element);return c},removeContainer:function(a){a.$container.remove();a.$container=null},createContainer:function(a){var b;b=d('<div class="modal-scrollable">').css("z-index",
k("modal",this.getOpenModals().length)).appendTo(this.$element);if(a&&"static"!=a.options.backdrop)b.on("click.modal",f(function(b){a.hide()}));else if(a)b.on("click.modal",f(function(b){a.attention()}));return b},backdrop:function(a,b){var c=a.$element.hasClass("fade")?"fade":"",e=a.options.backdrop&&this.backdropCount<this.options.backdropLimit;if(a.isShown&&e)e=d.support.transition&&c&&!this.$backdropHandle,a.$backdrop=this.createBackdrop(c,a.options.backdropTemplate),a.$backdrop.css("z-index",
k("backdrop",this.getOpenModals().length)),e&&a.$backdrop[0].offsetWidth,a.$backdrop.addClass("in"),this.backdropCount+=1,e?a.$backdrop.one(d.support.transition.end,b):b();else if(!a.isShown&&a.$backdrop){a.$backdrop.removeClass("in");this.backdropCount-=1;var g=this;d.support.transition&&a.$element.hasClass("fade")?a.$backdrop.one(d.support.transition.end,function(){g.removeBackdrop(a)}):g.removeBackdrop(a)}else b&&b()},removeSpinner:function(){this.$spinner&&this.$spinner.remove();this.$spinner=
null;this.isLoading=!1},removeLoading:function(){this.$backdropHandle&&this.$backdropHandle.remove();this.$backdropHandle=null;this.removeSpinner()},loading:function(a){a=a||function(){};this.$element.toggleClass("modal-open",!this.isLoading||this.hasOpenModal()).toggleClass("page-overflow",d(window).height()<this.$element.height());if(this.isLoading)if(this.isLoading&&this.$backdropHandle){this.$backdropHandle.removeClass("in");var b=this;d.support.transition?this.$backdropHandle.one(d.support.transition.end,
function(){b.removeLoading()}):b.removeLoading()}else a&&a(this.isLoading);else{this.$backdropHandle=this.createBackdrop("fade",this.options.backdropTemplate);this.$backdropHandle[0].offsetWidth;var c=this.getOpenModals();this.$backdropHandle.css("z-index",k("backdrop",c.length+1)).addClass("in");c=d(this.options.spinner).css("z-index",k("modal",c.length+1)).appendTo(this.$element).addClass("in");this.$spinner=d(this.createContainer()).append(c).on("click.modalmanager",d.proxy(this.loading,this));
this.isLoading=!0;d.support.transition?this.$backdropHandle.one(d.support.transition.end,a):a()}}};var k=function(){var a,b={};return function(c,e){if("undefined"===typeof a){var g=d('<div class="modal hide" />').appendTo("body"),f=d('<div class="modal-backdrop hide" />').appendTo("body");b.modal=+g.css("z-index");b.backdrop=+f.css("z-index");a=b.modal-b.backdrop;g.remove();f.remove()}return b[c]+a*e}}();d.fn.modalmanager=function(a,b){return this.each(function(){var c=d(this),e=c.data("modalmanager");
e||c.data("modalmanager",e=new h(this,a));"string"===typeof a&&e[a].apply(e,[].concat(b))})};d.fn.modalmanager.defaults={backdropLimit:999,resize:!0,spinner:'<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>',backdropTemplate:'<div class="modal-backdrop" />'};d.fn.modalmanager.Constructor=h}(jQuery);
